<!DOCTYPE html>
<html lang="ar">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Firebase Dashboard</title>
    <style>
      body {
        font-family: "Cairo", sans-serif !important;
        background: #f5f5f5;
        text-align: center;
      }
      .card {
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        max-width: 400px;
        margin: auto;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        font-family: "Cairo", sans-serif !important;
      }
      .card h2 {
        text-align: center;
        margin-bottom: 15px;
      }
      .form-group {
        margin-bottom: 15px;
      }
      .form-group label {
        display: block;
        margin-bottom: 5px;
      }
      .form-group input {
        width: 250px;
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
      }
      button {
        width: 100%;
        padding: 10px;
        background: #007bff;
        color: #fff;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        font-family: "Cairo", sans-serif !important;
        cursor: pointer;
        margin-bottom: 10px;
      }
      button:hover {
        background: #0056b3;
      }
      #logout {
        margin-top: 10px;
        background: #dc3545;
        display: none;
      }
      .AddDiv {
        margin: 30px auto;
        padding: 20px;
        background: #ffffff;
        border-radius: 15px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        max-width: 450px;
        text-align: center;
        display: none;
      }
      .AddDiv h3 {
        margin-bottom: 20px;
        color: #333;
        font-size: 20px;
      }
      .AddDiv input {
        text-align: center;
        width: 350px;
        padding: 12px;
        margin: 10px 0;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        font-family: "Cairo", sans-serif !important;
      }
      .AddDiv input:focus {
        border-color: #007bff;
        outline: none;
        box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
      }
      .AddDiv button {
        width: 100%;
        padding: 12px;
        background: #28a745;
        color: #fff;
        font-size: 16px;
        font-weight: bold;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        margin-top: 10px;
      }
      .AddDiv button:hover {
        background: #218838;
      }
      #addStatus {
        margin-top: 15px;
        font-size: 14px;
        color: #555;
      }
      #productsContainer {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        justify-items: center;
        margin-top: 30px;
      }
      #productsContainer > div {
        width: 100%;
        max-width: 300px;
        box-sizing: border-box;
        border: 1px solid #ccc;
        padding: 10px;
        margin: 10px auto;
        border-radius: 10px;
      }
      /* مودال التعديل */
      #editModal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }
      #editModalContent {
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        max-width: 400px;
        width: 90%;
        text-align: center;
      }
      #editModalContent input {
        width: 90%;
        padding: 10px;
        margin: 5px 0;
        border-radius: 8px;
        border: 1px solid #ccc;
      }
      #editModalContent button {
        margin-top: 10px;
      }
      @media (max-width: 768px) {
        #productsContainer {
          grid-template-columns: 1fr;
        }
        .AddDiv input,
        .AddDiv button {
          width: 90%;
        }
        #editModalContent input {
          width: 90%;
        }
      }
    </style>
  </head>
  <body>
    <div class="card">
      <h2>تسجيل الدخول</h2>
      <form id="login-form">
        <div class="form-group">
          <label for="email">البريد الإلكتروني</label>
          <input type="email" id="email" required />
        </div>
        <div class="form-group">
          <label for="password">كلمة المرور</label>
          <input type="password" id="password" required />
        </div>
        <button type="submit">دخول</button>
      </form>
      <button id="logout">تسجيل الخروج</button>
    </div>

    <div class="AddDiv">
      <h3>➕ إضافة منتج جديد</h3>
      <input type="text" id="name" placeholder="اسم المنتج" />
      <input type="text" id="price" placeholder="السعر" />
      <input type="text" id="image" placeholder="رابط الصورة" />
      <button id="addBtn">إضافة المنتج</button>
      <p id="addStatus"></p>
    </div>

    <div id="productsContainer"></div>

    <!-- مودال التعديل -->
    <div id="editModal">
      <div id="editModalContent">
        <h3>تعديل المنتج</h3>
        <input type="text" id="editName" placeholder="اسم المنتج" />
        <input type="text" id="editPrice" placeholder="السعر" />
        <input type="text" id="editImage" placeholder="رابط الصورة" />
        <button id="saveEditBtn" style="background: #28a745; color: #fff">
          حفظ التعديلات
        </button>
        <button id="cancelEditBtn" style="background: red; color: #fff">
          إلغاء
        </button>
      </div>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
      import {
        getAuth,
        onAuthStateChanged,
        signInWithEmailAndPassword,
        signOut,
      } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
      import {
        getFirestore,
        collection,
        addDoc,
        getDocs,
        deleteDoc,
        doc,
        updateDoc,
      } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBuk7KKqLr1s5OBY0VYd6Az4mfqtY5TTrQ",
        authDomain: "addproject-a4c85.firebaseapp.com",
        projectId: "addproject-a4c85",
        storageBucket: "addproject-a4c85.firebasestorage.app",
        messagingSenderId: "302422763360",
        appId: "1:302422763360:web:20fa63201abc9e6ef62005",
        measurementId: "G-L4CWPFE7WE",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      const loginForm = document.querySelector("#login-form");
      const emailInput = document.querySelector("#email");
      const passwordInput = document.querySelector("#password");
      const logoutBtn = document.querySelector("#logout");
      const addDiv = document.querySelector(".AddDiv");

      const addBtn = document.getElementById("addBtn");
      const nameInput = document.getElementById("name");
      const priceInput = document.getElementById("price");
      const imageInput = document.getElementById("image");
      const addStatus = document.getElementById("addStatus");

      const productsContainer = document.getElementById("productsContainer");

      const editModal = document.getElementById("editModal");
      const editName = document.getElementById("editName");
      const editPrice = document.getElementById("editPrice");
      const editImage = document.getElementById("editImage");
      const saveEditBtn = document.getElementById("saveEditBtn");
      const cancelEditBtn = document.getElementById("cancelEditBtn");

      let currentEditId = null;

      onAuthStateChanged(auth, (user) => {
        if (user) {
          addDiv.style.display = "block";
          logoutBtn.style.display = "inline-block";
          loadProducts();
        } else {
          addDiv.style.display = "none";
          logoutBtn.style.display = "none";
          productsContainer.innerHTML = "";
        }
      });

      loginForm.addEventListener("submit", (e) => {
        e.preventDefault();
        signInWithEmailAndPassword(auth, emailInput.value, passwordInput.value)
          .then(() => loginForm.reset())
          .catch((error) => alert("خطأ في تسجيل الدخول: " + error.message));
      });

      logoutBtn.addEventListener("click", () => signOut(auth));

      addBtn.addEventListener("click", async () => {
        const name = nameInput.value.trim();
        const price = priceInput.value.trim();
        const image = imageInput.value.trim();

        if (!name || !price || !image) {
          addStatus.textContent = "⚠️ من فضلك املأ كل الحقول";
          addStatus.style.color = "red";
          return;
        }

        try {
          await addDoc(collection(db, "products"), {
            name,
            price: Number(price),
            image,
            createdAt: new Date(),
          });
          addStatus.textContent = "✅ تم إضافة المنتج بنجاح!";
          addStatus.style.color = "green";
          nameInput.value = "";
          priceInput.value = "";
          imageInput.value = "";
          loadProducts();
        } catch (error) {
          addStatus.textContent = "❌ حصل خطأ أثناء الإضافة";
          addStatus.style.color = "red";
        }
      });

      async function loadProducts() {
        productsContainer.innerHTML = "";
        const querySnapshot = await getDocs(collection(db, "products"));
        querySnapshot.forEach((docSnap) => {
          const data = docSnap.data();
          const productDiv = document.createElement("div");
          productDiv.innerHTML = `
            <h4>${data.name}</h4>
            <p>السعر: ${data.price}</p>
            <img src="${data.image}" alt="${data.name}" style="max-width:100%; border-radius:10px"/>
            <button class="editBtn">تعديل</button>
            <button class="deleteBtn" style="background:red;">حذف</button>
          `;

          // حذف المنتج
          productDiv
            .querySelector(".deleteBtn")
            .addEventListener("click", async () => {
              await deleteDoc(doc(db, "products", docSnap.id));
              loadProducts();
            });

          // فتح مودال التعديل
          productDiv.querySelector(".editBtn").addEventListener("click", () => {
            currentEditId = docSnap.id;
            editName.value = data.name;
            editPrice.value = data.price;
            editImage.value = data.image;
            editModal.style.display = "flex";
          });

          productsContainer.appendChild(productDiv);
        });
      }

      // حفظ التعديلات
      saveEditBtn.addEventListener("click", async () => {
        if (!editName.value || !editPrice.value || !editImage.value) return;
        await updateDoc(doc(db, "products", currentEditId), {
          name: editName.value,
          price: Number(editPrice.value),
          image: editImage.value,
        });
        editModal.style.display = "none";
        loadProducts();
      });

      // إغلاق المودال
      cancelEditBtn.addEventListener("click", () => {
        editModal.style.display = "none";
      });
    </script>
  </body>
</html>
